{{ config(materialized='table',schema='stg')}}
------ two of them null---------------
SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    [add_EffectiveStartDate] as [EffectiveStartDate],
    [add_EffectiveEndDate] as [EffectiveEndDate]
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where email_EffectiveStartDate is null and phone_EffectiveStartDate is null

union 

SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    [email_EffectiveStartDate] as [EffectiveStartDate],
    [email_EffectiveEndDate] as [EffectiveEndDate]
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where add_EffectiveStartDate is null and phone_EffectiveStartDate is null
union all 

SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    [phone_EffectiveStartDate] as [EffectiveStartDate],
    [phone_EffectiveEndDate] as [EffectiveEndDate]
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where add_EffectiveStartDate is null and email_EffectiveStartDate is null

union all 

--------------------one value is null

SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    case WHEN email_EffectiveStartDate>phone_EffectiveStartDate THEN email_EffectiveStartDate else phone_EffectiveStartDate END as EffectiveStartDate,
    case WHEN email_EffectiveEndDate>phone_EffectiveEndDate THEN phone_EffectiveEndDate else email_EffectiveEndDate END as EffectiveEndDate
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where 
    add_EffectiveStartDate is null and email_EffectiveStartDate is not null and phone_EffectiveStartDate is not null


union all


SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    case WHEN email_EffectiveStartDate>phone_EffectiveStartDate THEN email_EffectiveStartDate else phone_EffectiveStartDate END as EffectiveStartDate,
    case WHEN email_EffectiveEndDate>phone_EffectiveEndDate THEN phone_EffectiveEndDate else email_EffectiveEndDate END as EffectiveEndDate
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where 
    add_EffectiveStartDate is null and email_EffectiveStartDate is not null and phone_EffectiveStartDate is not null

union all 

SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    case WHEN add_EffectiveStartDate>phone_EffectiveStartDate THEN add_EffectiveStartDate else phone_EffectiveStartDate END as EffectiveStartDate,
    case WHEN add_EffectiveEndDate>phone_EffectiveEndDate THEN phone_EffectiveEndDate else add_EffectiveEndDate END as EffectiveEndDate
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where 
    add_EffectiveStartDate is not null and email_EffectiveStartDate is null and phone_EffectiveStartDate is not null

union 

SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],
    case WHEN email_EffectiveStartDate>add_EffectiveStartDate THEN email_EffectiveStartDate else add_EffectiveStartDate END as EffectiveStartDate,
    case WHEN email_EffectiveEndDate>add_EffectiveEndDate THEN add_EffectiveEndDate else email_EffectiveEndDate END as EffectiveEndDate
FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where 
    add_EffectiveStartDate is not null and email_EffectiveStartDate is not null and phone_EffectiveStartDate is null

union all 

---------------all have value -----------------------------


SELECT 
    [CustomerAccountID],
    [CurrentCompanyID],
    [AddressID],
    [HomeAddress], 
    [BusinessAddress], 
    [LocalAddress], 
    [DealerAddress], 
    [MailingAddress],
    [City],
    [State],
    [PostalCode],
    [Country],
    [AddressStatus],
    [IsDefaultAddress],
    [IsActiveAddress],
    [ContactID],
    [EmailAddress],
    [IsActiveEmail],
    [EmailBlastOptIn],
    [MobilePhone_PhoneID], 
    [MobilePhone_PhoneNumber], 
    [MobilePhone_PhoneStatus], 
    [IsDefaultMobilePhone], 
    [IsActiveMobilePhone], 
    [DirectPhone_PhoneID], 
    [DirectPhone_PhoneNumber], 
    [DirectPhone_PhoneStatus],
    [IsDefaultDirectPhone],  
    [IsActiveDirectPhone],  
    [HomePhone_PhoneID],
    [HomePhone_PhoneNumber], 
    [HomePhone_PhoneStatus],  
    [IsDefaultHomePhone],  
    [IsActiveHomePhone],  
    [HomeFax_PhoneID],  
    [HomeFax_PhoneNumber], 
    [HomeFax_PhoneStatus],  
    [IsDefaultHomeFax],  
    [IsActiveHomeFax],  
    [DealerMobile_PhoneID],  
    [DealerMobile_PhoneNumber], 
    [DealerMobile_PhoneStatus],  
    [IsDefaultDealerMobile],  
    [IsActiveDealerMobile],  
    [DealerPhone_PhoneID],  
    [DealerPhone_PhoneNumber], 
    [DealerPhone_PhoneStatus],  
    [IsDefaultDealerPhone],  
    [IsActiveDealerPhone],  
    [DealerFax_PhoneID],  
    [DealerFax_PhoneNumber], 
    [DealerFax_PhoneStatus],  
    [IsDefaultDealerFax],  
    [IsActiveDealerFax],  
    [BusinessPhone_PhoneID],  
    [BusinessPhone_PhoneNumber], 
    [BusinessPhone_PhoneStatus],  
    [IsDefaultBusinessPhone],  
    [IsActiveBusinessPhone],  
    [BusinessFax_PhoneID],  
    [BusinessFax_PhoneNumber], 
    [BusinessFax_PhoneStatus],  
    [IsDefaultBusinessFax],  
    [IsActiveBusinessFax],  
    [BusinessMobile_PhoneID],  
    [BusinessMobile_PhoneNumber], 
    [BusinessMobile_PhoneStatus],  
    [IsDefaultBusinessMobile],  
    [IsActiveBusinessMobile], 
    [VendorPhone_PhoneID],  
    [VendorPhone_PhoneNumber], 
    [VendorPhone_PhoneStatus],  
    [IsDefaultVendorPhone],      
    [IsActiveVendorPhone],  
    [VendorFax_PhoneID],  
    [VendorFax_PhoneNumber], 
    [VendorFax_PhoneStatus],  
    [IsDefaultVendorFax],  
    [IsActiveVendorFax],  
    [RequestNumber_PhoneID],  
    [RequestNumber_PhoneNumber], 
    [RequestNumber_PhoneStatus],  
    [IsDefaultRequestNumber],  
    [IsActiveRequestNumber],  
    [RequestFax_PhoneID],  
    [RequestFax_PhoneNumber],
    [RequestFax_PhoneStatus],
    [IsDefaultRequestFax],
    [IsActiveRequestFax],
    [LocalPhone_PhoneID],
    [LocalPhone_PhoneNumber],
    [LocalPhone_PhoneStatus], 
    [IsDefaultLocalPhone],
    [IsActiveLocalPhone], 
    [Pager_PhoneID],
    [Pager_PhoneNumber], 
    [Pager_PhoneStatus],  
    [IsDefaultPager],
    [IsActivePager],
    [UnknownPhoneType_PhoneID],
    [UnknownPhoneType_PhoneNumber], 
    [UnknownPhoneType_PhoneStatus],  
    [IsDefaultUnknownPhoneType],
    [IsActiveUnknownPhoneType],

    CASE WHEN 
        CASE WHEN add_EffectiveStartDate < email_EffectiveStartDate THEN email_EffectiveStartDate ELSE add_EffectiveStartDate END < phone_EffectiveStartDate
        THEN phone_EffectiveStartDate
    ELSE CASE WHEN add_EffectiveStartDate < email_EffectiveStartDate THEN email_EffectiveStartDate ELSE add_EffectiveStartDate END as EffectiveStartDate

FROM [stg].[Auct_Customer_Archive_BR_Join_Merge] where 
    add_EffectiveStartDate is not null and email_EffectiveStartDate is not null and phone_EffectiveStartDate is not null
