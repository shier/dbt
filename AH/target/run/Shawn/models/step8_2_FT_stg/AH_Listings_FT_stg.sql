
  
  if object_id ('"stg"."AH_Listings_FT_stg__dbt_tmp_temp_view"','V') is not null
    begin
    drop view "stg"."AH_Listings_FT_stg__dbt_tmp_temp_view"
    end


   
    
  if object_id ('"stg"."AH_Listings_FT_stg__dbt_tmp"','U') is not null
    begin
    drop table "stg"."AH_Listings_FT_stg__dbt_tmp"
    end


   EXEC('create view stg.AH_Listings_FT_stg__dbt_tmp_temp_view as
    
SELECT
		l.[ID] AS [ListingID],
		l.[OwnerID],
		l.[PrimaryCategoryId],
		l.[CurrencyID],
		l.[ListingTypeID],
		lt.[Name] AS [ListingType],
		l.[CreatedOn] AS [CreatedDate],
		l.[UpdatedOn] AS [UpdatedDate],
		l.[DeletedOn] AS [DeletedDate],
		l.[Title],
		l.[OriginalRelistCount],
		l.[Hits],
		l.[EndDTTM],
		l.[StartDTTM],
		l.[Subtitle],
		l.[Location],
		l.[Status],
		l.[CurrentPrice],
		l.[LastUpdatedUser],
		l.[Duration],
		l.[Version],
		l.[Increment],
		l.[OriginalPrice],
		l.[AutoRelistRemaining],
		l.[CurrentQuantity],
		l.[OriginalQuantity],
		l.[RelistIteration],
		l.[PrimaryImageURI],
		l.[AcceptedActionCount],
		l.[OwnerUserName],
		l.[CurrentListingActionId],
		l.[CurrentListingActionUserName],
		l.[OfferCount],
		lp.[VehicleStoryOpeningStatement],
		lp.[VehicleStoryDescriptionCarFax],
		lp.[Acct_Rep_Phone],
		lp.[HasMagicBox],
		lp.[HasDealerFee],
		lp.[VehicleStory],
		lp.[CarfaxPassFailError],
		lp.[LeadSource],
		lp.[VehicleStoryDescriptionInterior2Pictures],
		lp.[Decade],
		lp.[PaintWork],
		lp.[Specialist_Section_Comp2_Info],
		lp.[Curated],
		lp.[VehicleStoryDescriptionUndercarriagePictures],
		lp.[IsFeaturedVehicle],
		lp.[VehicleStoryOpeningStatementPictures],
		lp.[Copy_Writer_Status],
		lp.[FixedPrice],
		lp.[LockUsername],
		lp.[NoReserveCheck],
		lp.[VehicleStoryDescriptionCarFaxPictures],
		lp.[BeenListed],
		lp.[Acct_Rep],
		lp.[MagicBoxSection4],
		lp.[Copy_Writer],
		lp.[Taxonomy],
		lp.[PersonalMileage],
		lp.[Specialist_Section_Comp2_Price],
		lp.[VehicleStoryDescriptionInterior2],
		lp.[VehicleStoryDescriptionUndercarriage],
		lp.[VehicleStoryDescriptionInteriorPictures],
		lp.[Acct_Rep_Name],
		lp.[CarfaxLink],
		lp.[HideListing],
		lp.[CurrentIssues],
		lp.[TargetReserve],
		lp.[TransactionId],
		lp.[Specialist],
		lp.[BuyItNow],
		lp.[VehicleStoryDescriptionEngineTransmission],
		lp.[CountryOfOrigin],
		lp.[CommissionOverrideReason],
		lp.[WhereDidYouHearAboutUsListingReferral],
		lp.[CaliforniaSmogCheck],
		lp.[Modifications],
		lp.[Zip],
		lp.[ListingState],
		lp.[AnythingElseWeShouldKnow],
		lp.[VehicleTitle],
		lp.[Specialist_Section_Notes],
		lp.[VehicleStoryDescriptionExterior2],
		lp.[Photo_Plan],
		lp.[VehicleStoryDescriptionExterior2Pictures],
		lp.[Era],
		lp.[Commission],
		lp.[MakeOfferAvailable],
		lp.[IsEdited],
		lp.[WhereDidYouHearAboutUsListingOther],
		lp.[MagicBoxSection1],
		lp.[VehicleStoryDescriptionExteriorPictures],
		lp.[Specialist_Section_Original_Reserve],
		lp.[Specialist_Section_Comp1_Info],
		lp.[UI_ListingStateHold],
		lp.[AddressLine2],
		lp.[Specialist_Section_Comp5_Price],
		lp.[WGL_Public_Report],
		lp.[PremiumListing],
		lp.[ReservePrice],
		lp.[DealerURL],
		lp.[IsPaid],
		lp.[OriginalEngineText],
		lp.[HasProMarketing],
		lp.[PhotoPlanId],
		lp.[TransmissionText],
		lp.[MakeOfferAllowed],
		lp.[SchedulingComplete],
		lp.[ServiceRecords],
		lp.[CountryCL],
		lp.[OdometerUnits],
		lp.[BuyItNowUsed],
		lp.[MagicBoxSection3],
		lp.[SnapprPackage],
		lp.[CarfaxPassFail],
		lp.[CCID],
		lp.[StateProvinceRegion],
		lp.[DealerName],
		lp.[ListingProgress],
		lp.[StartingBid],
		lp.[EstimatedMarketValue],
		lp.[Mileage],
		lp.[IsPromoVehicle],
		lp.[MagicBoxSection2],
		lp.[SpinCarLink],
		lp.[MagicBoxSection5],
		lp.[Photo_Plan_Status],
		lp.[Address],
		lp.[HaveAllPhotos],
		lp.[MagicBoxSection6],
		lp.[OriginalEngine],
		lp.[VehicleStoryDescriptionInterior],
		lp.[UserComments],
		lp.[CarTitleInYourName],
		lp.[MarketValue],
		lp.[PackageTransactionId],
		lp.[Specialist_Section_Comp1_Price],
		lp.[Rust],
		lp.[MakeWholeAmount],
		lp.[Specialist_Section_Comp3_Price],
		lp.[VehicleStoryDescriptionEngineTransmissionPictures],
		lp.[WhereDidYouHearAboutUsListing],
		lp.[HasProPhotography],
		lp.[IsApproved],
		lp.[ListingNotes],
		lp.[Specialist_Section_Comp4_Info],
		lp.[HowLongOwned],
		lp.[DraftEmailNotificationSent],
		lp.[Copy_Writer_Feedback],
		lp.[ExpertVideoReview],
		lp.[Specialist_Section_Comp5_Info],
		lp.[Comped],
		lp.[BeenListedText],
		lp.[IsTaxable],
		lp.[Transmission],
		lp.[BeenModified],
		lp.[Specialist_Section_Comp3_Info],
		lp.[CityCL],
		lp.[PaintWorkText],
		lp.[Dealer],
		lp.[ReservePriceCL],
		lp.[MileageAccurate],
		lp.[Acct_Rep_Email],
		lp.[LastServiceInformation],
		lp.[DealerFees],
		lp.[Specialist_Section_Comp4_Price],
		lp.[VehicleStoryDescriptionExterior]
from [stg].[AH_Listings_FinalView] l
left join dbo.SZ_AH_Properties_Pivot lp on l.ID=lp.ListingID
left join [stg].[AH_ListingTypes_FinalView] lt on l.ListingTypeID=lt.ID
    ');

  CREATE TABLE "stg"."AH_Listings_FT_stg__dbt_tmp"
    WITH(
      DISTRIBUTION = ROUND_ROBIN,
      CLUSTERED COLUMNSTORE INDEX
      )
    AS (SELECT * FROM stg.AH_Listings_FT_stg__dbt_tmp_temp_view)

   
  
  if object_id ('"stg"."AH_Listings_FT_stg__dbt_tmp_temp_view"','V') is not null
    begin
    drop view "stg"."AH_Listings_FT_stg__dbt_tmp_temp_view"
    end


