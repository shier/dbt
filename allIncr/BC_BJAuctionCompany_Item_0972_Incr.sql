{{ config(materialized='incremental',schema='stg',unique_key='dbt_scd_id')}}
With hashData as (
		Select
			*,HASHBYTES('SHA2_256', concat([No], [Description2], [No_2], [VendorItemNo], [ItemDisc_Group], [No_Series], [Picture], [DefaultDeferralTemplateCode], [ApplicationWksh_UserID], [GlobalDimension1Code], [SalesUnitofMeasure], [ServiceItemGroup], [ItemCategoryCode], [DampenerPeriod], [Put_awayTemplateCode], [ExpirationCalculation], [ItemTrackingCode], [TaxGroupId], [Put_awayUnitofMeasureCode], [ItemCategoryId], [ProductionBOMNo], [SATItemClassification], Cast([Rolled_upCap_OverheadCost] as varchar), Cast([OverheadRate] as varchar), Cast([ReorderQuantity] as varchar), Cast([ReorderPoint] as varchar), Cast([BudgetQuantity] as varchar), Cast([UnitVolume] as varchar), Cast([NetWeight] as varchar), Cast([Rolled_upMaterialCost] as varchar), Cast([BudgetedAmount] as varchar), Cast([MaximumOrderQuantity] as varchar), Cast([Single_LevelMfg_OvhdCost] as varchar), Cast([Single_LevelSubcontrd_Cost] as varchar), Cast([OverflowLevel] as varchar), Cast([StandardCost] as varchar), Cast([UnitPrice] as varchar), Cast([systemCreatedAt] as varchar), Cast([NextCountingStartDate] as varchar), Cast([LastDateTimeModified] as varchar), Cast([CostisAdjusted] as varchar), Cast([Price_ProfitCalculation] as varchar), Cast([StockoutWarning] as varchar), Cast([AutomaticExt_Texts] as varchar), Cast([DiscreteOrderQuantity] as varchar), Cast([AssemblyPolicy] as varchar), Cast([UseCross_Docking] as varchar), Cast([Critical] as varchar), [systemModifiedBy], [Over_ReceiptCode], [BaseUnitofMeasure], [SearchDescription], [LeadTimeCalculation], [ShelfNo], [Country_RegionPurchasedCode], [FreightType], [DutyCode], [VATBus_PostingGr_Price], [GTIN], [ReschedulingPeriod], [Purch_UnitofMeasure], [SafetyLeadTime], [WarehouseClassCode], [LotNos], [DutyClass], [UnitofMeasureId], [PhysInvtCountingPeriodCode], [systemId], [CommonItemNo], [RoutingNo], Cast([DutyDue] as varchar), Cast([UnitsperParcel] as varchar), Cast([GrossWeight] as varchar), Cast([Rolled_upCapacityCost] as varchar), Cast([LotSize] as varchar), Cast([RoundingPrecision] as varchar), Cast([SafetyStockQuantity] as varchar), Cast([MinimumOrderQuantity] as varchar), Cast([Single_LevelMaterialCost] as varchar), Cast([UnitCost] as varchar), Cast([LastUnitCostCalc_Date] as varchar), Cast([LastDateModified] as varchar), Cast([CostingMethod] as varchar), Cast([CommissionGroup] as varchar), Cast([PreventNegativeInventory] as varchar), Cast([Reserve] as varchar), Cast([PriceIncludesVAT] as varchar), Cast([ReplenishmentSystem] as varchar), Cast([Low_LevelCode] as varchar), Cast([ManufacturingPolicy] as varchar), Cast([ReorderingPolicy] as varchar), Cast([SalesBlocked] as varchar), Cast([AllowInvoiceDisc] as varchar), Cast([PriceUnitConversion] as varchar), [PurchasingCode], [Description], [AlternativeItemNo], [VendorNo], [BlockReason], [TariffNo], [Country_RegionofOriginCode], [Gen_Prod_PostingGroup], [GlobalDimension2Code], [VATProd_PostingGroup], [TimeBucket], [SerialNos], [ProductGroupCode], [ManufacturerCode], [LotAccumulationPeriod], [SpecialEquipmentCode], [Id], Cast([timestamp] as varchar), Cast([Rolled_upSubcontractedCost] as varchar), Cast([UnitListPrice] as varchar), Cast([MaximumInventory] as varchar), Cast([IndirectCost] as varchar), Cast([DutyUnitConversion] as varchar), Cast([BudgetProfit] as varchar), Cast([DampenerQuantity] as varchar), Cast([OrderMultiple] as varchar), Cast([Single_LevelCap_OvhdCost] as varchar), Cast([Single_LevelCapacityCost] as varchar), Cast([LastDirectCost] as varchar), Cast([Profit] as varchar), Cast([systemModifiedAt] as varchar), Cast([NextCountingEndDate] as varchar), Cast([AllowOnlineAdjustment] as varchar), Cast([StatisticsGroup] as varchar), Cast([Blocked] as varchar), Cast([FlushingMethod] as varchar), Cast([InventoryValueZero] as varchar), Cast([OrderTrackingPolicy] as varchar), Cast([CreatedFromNonstockItem] as varchar), [InventoryPostingGroup], [systemCreatedBy], [Durability], [TaxGroupCode], Cast([Rolled_upMfg_OvhdCost] as varchar), Cast([Scrap] as varchar), Cast([LastCountingPeriodUpdate] as varchar), Cast([LastTimeModified] as varchar), Cast([IncludeInventory] as varchar), Cast([PurchasingBlocked] as varchar), Cast([Type] as varchar))) as dbt_scd_id,
			CURRENT_TIMESTAMP as dbt_updated_at, 
			CURRENT_TIMESTAMP as dbt_valid_from, 
			NULL as dbt_valid_to
		From stg.[BC_BJAuctionCompany_Item_0972_InterView]
	)
Select * From hashData
{% if is_incremental() %}
	where not exists 
	(
		select dbt_scd_id 
		from {{ this }} compareData
		where hashData.dbt_scd_id=compareData.dbt_scd_id
	)
{% endif %}
