{{ config(materialized='incremental',schema='stg',unique_key='dbt_scd_id')}}
With hashData as (
		Select
			*,HASHBYTES('SHA2_256', concat([systemCreatedBy], [ItemReferenceNo], [DocumentNo], [Description2], [LocationCode], [Gen_Prod_PostingGroup], [ShortcutDimension1Code], [TransportMethod], [ICPartnerReference], [BlanketOrderNo], [TaxGroupCode], [DepreciationBookCode], [VariantCode], [UnitofMeasureCrossRef], [ResponsibilityCenter], [InsuranceNo], [ReturnReasonCode], [PurchasingCode], [ICPartnerCode], [ReceiptNo], [ICCross_ReferenceNo], [OrderNo], [ProvincialTaxAreaCode], Cast([systemModifiedAt] as varchar), Cast([ExpectedReceiptDate] as varchar), Cast([System_CreatedEntry] as varchar), Cast([UseTax] as varchar), Cast([FAPostingType] as varchar), Cast([PrepaymentLine] as varchar), Cast([OrderLineNo] as varchar), Cast([VATCalculationType] as varchar), Cast([AllowInvoiceDisc] as varchar), Cast([LineNo] as varchar), Cast([GrossWeight] as varchar), Cast([AmountIncludingVAT] as varchar), Cast([UnitCost] as varchar), Cast([IndirectCost] as varchar), Cast([OverheadRate] as varchar), Cast([QuantityBase] as varchar), Cast([VATDifference] as varchar), Cast([JobUnitPriceLCY] as varchar), Cast([JobLineDiscountAmount] as varchar), Cast([LineDiscount] as varchar), Cast([UnitCostLCY] as varchar), Cast([Quantity] as varchar), [ItemReferenceUnitofMeasure], [PostingGroup], [VendorItemNo], [ShortcutDimension2Code], [TransactionSpecification], [EntryPoint], [BinCode], [BudgetedFANo], [RoutingNo], [Cross_ReferenceTypeNo], [OperationNo], [DeferralCode], [JobCurrencyCode], Cast([systemCreatedAt] as varchar), Cast([FAPostingDate] as varchar), Cast([TaxLiable] as varchar), Cast([Nonstock] as varchar), Cast([UseDuplicationList] as varchar), Cast([Depr_untilFAPostingDate] as varchar), Cast([DimensionSetID] as varchar), Cast([ReceiptLineNo] as varchar), Cast([Prod_OrderLineNo] as varchar), Cast([PriceCalculationMethod] as varchar), Cast([UnitPriceLCY] as varchar), Cast([Amount] as varchar), Cast([Inv_DiscountAmount] as varchar), Cast([UnitVolume] as varchar), Cast([JobLineDiscount] as varchar), Cast([JobLineAmount] as varchar), Cast([JobUnitPrice] as varchar), Cast([JobCurrencyFactor] as varchar), Cast([JobLineAmountLCY] as varchar), Cast([timestamp] as varchar), [systemModifiedBy], [ItemReferenceTypeNo], [Buy_fromVendorNo], [UnitofMeasure], [Description], [No], [Gen_Bus_PostingGroup], [JobNo], [TaxAreaCode], [Area], [TransactionType], [VATIdentifier], [VATBus_PostingGroup], [MaintenanceCode], [Prod_OrderNo], [ProductGroupCode], [Pay_toVendorNo], [WorkCenterNo], [systemId], Cast([ICPartnerRef_Type] as varchar), Cast([BlanketOrderLineNo] as varchar), Cast([Depr_AcquisitionCost] as varchar), Cast([RoutingReferenceNo] as varchar), Cast([IRS1099Liable] as varchar), Cast([ItemReferenceType] as varchar), Cast([JobLineType] as varchar), Cast([Appl__toItemEntry] as varchar), Cast([Type] as varchar), Cast([NetWeight] as varchar), Cast([LineDiscountAmount] as varchar), Cast([VATBaseAmount] as varchar), Cast([UnitsperParcel] as varchar), Cast([SalvageValue] as varchar), Cast([Qty_perUnitofMeasure] as varchar), Cast([LineAmount] as varchar), Cast([JobTotalPrice] as varchar), Cast([Pmt_DiscountAmount] as varchar), Cast([JobLineDisc_AmountLCY] as varchar), Cast([JobTotalPriceLCY] as varchar), Cast([VAT] as varchar), Cast([DirectUnitCost] as varchar), [UnitofMeasureCode], [Cross_ReferenceNo], [ItemCategoryCode], [JobTaskNo], Cast([PostingDate] as varchar), [VATProd_PostingGroup], [DuplicateinDepreciationBook], Cast([AttachedtoLineNo] as varchar), Cast([Cross_ReferenceType] as varchar))) as dbt_scd_id,
			CURRENT_TIMESTAMP as dbt_updated_at, 
			CURRENT_TIMESTAMP as dbt_valid_from, 
			NULL as dbt_valid_to
		From stg.[BC_BJAuctionCompany_PurchInvLine_0972_InterView]
	)
Select * From hashData
{% if is_incremental() %}
	where not exists 
	(
		select dbt_scd_id 
		from {{ this }} compareData
		where hashData.dbt_scd_id=compareData.dbt_scd_id
	)
{% endif %}
