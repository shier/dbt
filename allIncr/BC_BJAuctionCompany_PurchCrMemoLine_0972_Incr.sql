{{ config(materialized='incremental',schema='stg',unique_key='dbt_scd_id')}}
With hashData as (
		Select
			*,HASHBYTES('SHA2_256', concat(Cast([AmountIncludingVAT] as varchar), Cast([LineDiscountAmount] as varchar), Cast([VATBaseAmount] as varchar), Cast([UnitsperParcel] as varchar), Cast([SalvageValue] as varchar), Cast([LineAmount] as varchar), Cast([JobUnitPriceLCY] as varchar), Cast([JobTotalPrice] as varchar), Cast([JobCurrencyFactor] as varchar), Cast([systemCreatedAt] as varchar), Cast([FAPostingDate] as varchar), Cast([ICPartnerRef_Type] as varchar), Cast([TaxLiable] as varchar), Cast([Nonstock] as varchar), Cast([UseDuplicationList] as varchar), Cast([ReturnShipmentLineNo] as varchar), Cast([DimensionSetID] as varchar), Cast([IRS1099Liable] as varchar), Cast([ItemReferenceType] as varchar), Cast([AllowInvoiceDisc] as varchar), [ShortcutDimension1Code], [Description2], [TransportMethod], [Gen_Bus_PostingGroup], [VATBus_PostingGroup], [TaxAreaCode], [TransactionSpecification], [VariantCode], [BlanketOrderNo], [BudgetedFANo], [DepreciationBookCode], [ItemCategoryCode], [Cross_ReferenceNo], [ICPartnerCode], [ReturnReasonCode], [OrderNo], [ProvincialTaxAreaCode], [JobCurrencyCode], [ItemReferenceTypeNo], [ItemReferenceNo], Cast([timestamp] as varchar), [No], [DocumentNo], Cast([NetWeight] as varchar), Cast([IndirectCost] as varchar), Cast([Qty_perUnitofMeasure] as varchar), Cast([JobLineDiscountAmount] as varchar), Cast([JobLineAmountLCY] as varchar), Cast([VAT] as varchar), Cast([DirectUnitCost] as varchar), Cast([systemModifiedAt] as varchar), Cast([BlanketOrderLineNo] as varchar), Cast([Depr_untilFAPostingDate] as varchar), Cast([OrderLineNo] as varchar), Cast([Appl__toItemEntry] as varchar), Cast([Type] as varchar), [ShortcutDimension2Code], [Description], [Gen_Prod_PostingGroup], [VendorItemNo], [Area], [ICPartnerReference], [MaintenanceCode], [UnitofMeasureCode], [UnitofMeasureCrossRef], [DuplicateinDepreciationBook], [PurchasingCode], [systemCreatedBy], Cast([UnitPriceLCY] as varchar), Cast([Amount] as varchar), Cast([UnitCost] as varchar), Cast([Inv_DiscountAmount] as varchar), Cast([UnitVolume] as varchar), Cast([JobUnitPrice] as varchar), Cast([QuantityBase] as varchar), Cast([VATDifference] as varchar), Cast([JobTotalPriceLCY] as varchar), Cast([JobLineDiscount] as varchar), Cast([JobLineAmount] as varchar), Cast([Pmt_DiscountAmount] as varchar), Cast([UnitCostLCY] as varchar), Cast([Quantity] as varchar), Cast([PostingDate] as varchar), Cast([ExpectedReceiptDate] as varchar), Cast([System_CreatedEntry] as varchar), Cast([UseTax] as varchar), Cast([Depr_AcquisitionCost] as varchar), Cast([FAPostingType] as varchar), Cast([JobLineType] as varchar), Cast([PrepaymentLine] as varchar), Cast([PriceCalculationMethod] as varchar), Cast([VATCalculationType] as varchar), [UnitofMeasure], [TransactionType], [JobNo], [TaxGroupCode], [EntryPoint], [Prod_OrderNo], [InsuranceNo], [Cross_ReferenceTypeNo], [ResponsibilityCenter], [JobTaskNo], [ProductGroupCode], [systemId], [DeferralCode], [ReturnShipmentNo], [systemModifiedBy], [ItemReferenceUnitofMeasure], [ICItemReferenceNo], [LocationCode], [Buy_fromVendorNo], Cast([GrossWeight] as varchar), Cast([JobLineDisc_AmountLCY] as varchar), Cast([LineDiscount] as varchar), Cast([AttachedtoLineNo] as varchar), Cast([Cross_ReferenceType] as varchar), Cast([LineNo] as varchar), [PostingGroup], [VATIdentifier], [VATProd_PostingGroup], [BinCode], [Pay_toVendorNo])) as dbt_scd_id,
			CURRENT_TIMESTAMP as dbt_updated_at, 
			CURRENT_TIMESTAMP as dbt_valid_from, 
			NULL as dbt_valid_to
		From stg.[BC_BJAuctionCompany_PurchCrMemoLine_0972_InterView]
	)
Select * From hashData
{% if is_incremental() %}
	where not exists 
	(
		select dbt_scd_id 
		from {{ this }} compareData
		where hashData.dbt_scd_id=compareData.dbt_scd_id
	)
{% endif %}
